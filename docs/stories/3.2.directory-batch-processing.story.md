# Story 3.2: Directory Batch Processing

**Status:** Draft

**Epic:** Epic 3: Batch Processing & CLI

## User Story

As a user with multiple invoices,
I want to process entire directories of invoice files,
so that I can efficiently handle bulk invoice processing.

## Acceptance Criteria

1. Directory input support (`node index.js <directory>`)
2. All PDF files in directory processed
3. Progress indication for batch operations
4. Summary report of successful/failed processing

## Dev Notes

### Previous Story Insights
Story 3.1 established basic CLI functionality for single file processing. The commander.js framework is integrated and working. This provides the foundation for extending to directory-based batch processing with progress tracking and summary reporting.

### Data Models
Directory batch processing requires:
- Directory scanning and file enumeration
- Batch processing coordination
- Progress tracking and status reporting
- Success/failure aggregation and summary
- Error handling for individual file failures

[Source: docs/architecture/backend-architecture.md#service-architecture]

### API Specifications
Extend CLI to support directory input. New functionality will include:
- Recursive directory scanning option
- File filtering (PDF only by default)
- Batch processing with individual file error isolation
- Progress reporting during processing
- Summary statistics on completion

### Component Specifications
Extend existing CLI with directory processing capabilities. Add directory scanning, batch coordination, and progress reporting features while maintaining single file processing compatibility.

### File Locations
Core implementation extends index.js with directory processing logic. No additional files required - batch processing integrates with existing CLI framework.

[Source: docs/architecture/backend-architecture.md#technology-stack]

### Testing Requirements
Directory batch processing testing requires filesystem setup and validation. Test directory scanning, file filtering, batch processing coordination, and progress reporting.

[Source: docs/architecture/quality-assurance-architecture.md#testing-strategy]

### Technical Constraints
- Maintain backward compatibility with single file processing
- Use synchronous directory scanning for simplicity
- Handle large directories efficiently
- Provide clear progress feedback for long operations
- Isolate individual file errors from batch failure

[Source: docs/architecture/backend-architecture.md#technology-stack]

## Tasks / Subtasks

### Task 1: Directory Input Support [AC1]
- Add directory path argument support to CLI
- Implement directory existence and accessibility validation
- Create directory scanning functionality
- Test directory input parsing and validation

### Task 2: PDF File Filtering [AC2]
- Implement PDF file detection and filtering
- Add recursive directory scanning option
- Handle various file extensions (.pdf, .PDF)
- Test file filtering with mixed file types

### Task 3: Batch Processing Coordination [AC2]
- Create batch processing orchestration
- Handle individual file processing errors gracefully
- Maintain processing order consistency
- Test batch processing with multiple files

### Task 4: Progress Indication [AC3]
- Implement progress reporting during batch operations
- Add file count and current file indicators
- Provide estimated completion time for large batches
- Test progress display formatting

### Task 5: Summary Report Generation [AC4]
- Create processing summary with success/failure counts
- Include detailed error reporting for failed files
- Generate processing statistics and timing information
- Test summary report formatting and accuracy

### Task 6: Batch Processing Integration and Testing
- Integrate batch processing with existing CLI framework
- Test complete directory processing workflow
- Validate all acceptance criteria with test directories
- Performance testing with large file batches

## Testing

### Unit Testing Requirements
- Directory scanning and file filtering tests
- Batch processing coordination tests
- Progress reporting tests
- Summary report generation tests

### Integration Testing Requirements
- End-to-end directory batch processing tests
- Mixed success/failure scenario testing
- Large directory performance testing
- Progress reporting validation tests

### Test Data
- Test directories with multiple PDF files
- Mixed file type directories for filtering tests
- Directories with various error conditions
- Large file sets for performance testing

## Change Log
- 2025-12-07: Initial story creation for directory batch processing in Epic 3