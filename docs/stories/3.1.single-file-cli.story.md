# Story 3.1: Single File CLI

**Status:** Draft

**Epic:** Epic 3: Batch Processing & CLI

## User Story

As a user,
I want a command-line interface to process individual invoice files,
so that I can easily parse single invoices from the terminal.

## Acceptance Criteria

1. `node index.js <file.pdf>` command working
2. JSON output to console or file
3. Help documentation available
4. Error handling with clear messages

## Dev Notes

### Previous Story Insights
Epic 2 successfully extended multi-language and multi-currency capabilities. The core parsing engine now handles English, German, and French invoices with proper EUR, GBP, and other currency support. This provides a solid foundation for building the CLI interface that users will interact with directly.

### Data Models
CLI requires command-line argument parsing and output formatting. The existing JSON schema from Story 1.4 provides the data structure, but CLI needs:
- File path validation and existence checking
- Output format selection (JSON/console)
- Error message formatting for CLI consumption
- Help text and usage information

[Source: docs/architecture/backend-architecture.md#api-design]

### API Specifications
CLI will serve as the primary user interface for the invoice parser. Command-line arguments will control:
- Input file specification
- Output format and destination
- Processing options and flags
- Error reporting and exit codes

### Component Specifications
Implement CLI functionality using commander.js (already in package.json). Create CLI wrapper around existing AmazonInvoiceParser class with:
- Command-line argument parsing
- File validation and error handling
- Output formatting (JSON to console/file)
- Help documentation and usage examples
- Exit code management for scripting

### File Locations
Core CLI implementation in main index.js file. Extend existing file with CLI command parsing and execution logic. No additional files required for basic CLI functionality.

[Source: docs/architecture/backend-architecture.md#technology-stack]

### Testing Requirements
CLI testing requires command-line execution validation. Test CLI commands, argument parsing, output formatting, and error conditions. Use shell command testing and output validation.

[Source: docs/architecture/quality-assurance-architecture.md#testing-strategy]

### Technical Constraints
- Use commander.js for CLI framework (already specified)
- Maintain backward compatibility with programmatic API
- Follow CLI conventions (exit codes, stderr for errors)
- Keep CLI simple for single file processing
- Performance: CLI overhead should be minimal

[Source: docs/architecture/backend-architecture.md#technology-stack]

## Tasks / Subtasks

### Task 1: CLI Framework Setup [AC1]
- Implement commander.js CLI framework integration
- Create basic command structure for single file processing
- Set up command-line argument parsing (<file.pdf>)
- Test basic CLI command execution

### Task 2: File Validation and Processing [AC1]
- Add file existence and PDF format validation
- Integrate with existing AmazonInvoiceParser
- Handle file reading errors gracefully
- Test file processing pipeline

### Task 3: Output Formatting [AC2]
- Implement JSON output to console
- Add file output option (--output <file>)
- Format JSON output for readability
- Test output formatting and file writing

### Task 4: Help Documentation [AC3]
- Create comprehensive help text with usage examples
- Document all command-line options and flags
- Add version information display
- Test help command functionality

### Task 5: Error Handling and Messages [AC4]
- Implement clear error messages for common issues
- Add proper exit codes (0 for success, 1+ for errors)
- Handle invalid arguments and file errors
- Test error conditions and messaging

### Task 6: CLI Integration and Testing
- Integrate CLI with existing parsing functionality
- Test complete CLI workflow with real PDF files
- Validate all acceptance criteria
- Performance testing of CLI execution

## Testing

### Unit Testing Requirements
- CLI argument parsing validation tests
- File validation and error handling tests
- Output formatting tests
- Command execution tests

### Integration Testing Requirements
- End-to-end CLI command execution tests
- File processing and output validation tests
- Error condition handling tests
- Cross-platform CLI compatibility tests

### Test Data
- Valid PDF files for successful processing tests
- Invalid files for error handling tests
- Various command-line argument combinations
- Expected JSON output validation

## Change Log
- 2025-12-07: Initial story creation for single file CLI in Epic 3