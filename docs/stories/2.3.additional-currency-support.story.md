# Story 2.3: Additional Currency Support

**Status:** Draft

**Epic:** Epic 2: Multi-Format Support

## User Story

As a user with international Amazon purchases,
I want support for GBP and other common currencies,
so that I can process invoices from various Amazon marketplaces.

## Acceptance Criteria

1. GBP (£) currency symbol support
2. Additional currency formats handled
3. Currency-specific decimal formatting
4. Multi-currency invoice processing

## Dev Notes

### Previous Story Insights
Stories 2.1 and 2.2 successfully extended multi-language capabilities to German and French marketplaces with EUR currency support. The system now handles German (1.588,22 €), French (1 588,22 €), and English currency formatting. This foundation enables adding additional currencies like GBP (£) with proper locale-specific formatting.

### Data Models
Multi-currency invoice data requires currency-aware parsing and formatting:
- GBP: £1,588.22 (UK format with comma separators)
- Additional currencies: CAD ($), AUD ($), etc.
- Currency detection and preservation in output
- Locale-specific number formatting validation

[Source: docs/architecture/backend-architecture.md#service-architecture]

### API Specifications
No new API endpoints required - this extends existing currency handling in data extraction services. The core parseInvoice method will automatically detect and process various currency formats while preserving original formatting in JSON output.

### Component Specifications
Extend existing currency detection and formatting logic in index.js. Add comprehensive currency pattern matching for:
- GBP (£) with UK decimal formatting (£1,588.22)
- Additional currencies (CAD, AUD, JPY, etc.)
- Currency symbol detection and validation
- Locale-specific decimal formatting preservation

### File Locations
Core implementation remains in index.js with enhanced currency patterns. No additional files required - this is an extension of existing currency handling logic.

[Source: docs/architecture/backend-architecture.md#technology-stack]

### Testing Requirements
Test with invoices containing GBP and other currencies. Validate currency-specific formatting is preserved. Ensure multi-currency invoices process correctly.

Test data should include various currency formats and marketplace combinations.

[Source: docs/architecture/quality-assurance-architecture.md#test-data-validation-resources]

### Technical Constraints
- Maintain backward compatibility with existing EUR and USD patterns
- Add currency patterns as additional regex options
- Preserve original currency formatting in output
- Ensure currency detection works across all supported languages
- Performance impact should be minimal (additional regex patterns)

[Source: docs/architecture/backend-architecture.md#technology-stack]

## Tasks / Subtasks

### Task 1: GBP Currency Symbol Support [AC1]
- Add GBP (£) currency symbol recognition
- Implement UK decimal formatting (£1,588.22)
- Handle GBP currency variations and positioning
- Validate GBP currency handling in extraction

### Task 2: Additional Currency Format Handling [AC2]
- Add support for CAD ($) with Canadian formatting
- Add support for AUD ($) with Australian formatting
- Add support for JPY (¥) with Japanese formatting
- Add support for CHF (Fr) with Swiss formatting

### Task 3: Currency-Specific Decimal Formatting [AC3]
- Implement locale-specific decimal separators
- Handle comma vs period decimal conventions
- Preserve currency-specific thousand separators
- Validate formatting preservation in output

### Task 4: Multi-Currency Invoice Processing [AC4]
- Enable processing of invoices with mixed currencies
- Implement currency detection and validation
- Ensure consistent JSON output across currencies
- Test multi-currency batch processing

### Task 5: Currency Pattern Integration
- Integrate all currency patterns into existing extraction methods
- Ensure currency patterns work across all supported languages
- Test pattern precedence and conflict resolution
- Validate comprehensive multi-currency processing

### Task 6: Currency Validation and Testing
- Test complete multi-currency invoice processing pipeline
- Validate all acceptance criteria with international test data
- Ensure currency formatting preservation in JSON output
- Performance testing with various currency formats

## Testing

### Unit Testing Requirements
- Individual currency pattern validation tests
- Currency-specific formatting tests
- Multi-currency detection tests
- Currency symbol recognition tests

### Integration Testing Requirements
- End-to-end multi-currency invoice processing tests
- Currency formatting preservation in JSON output
- Mixed currency batch processing tests
- International marketplace compatibility tests

### Test Data
- GBP amazon.co.uk invoice samples
- CAD amazon.ca invoice samples
- AUD amazon.com.au invoice samples
- Mixed currency invoice validation
- Various currency formatting combinations

## Change Log
- 2025-12-07: Initial story creation for additional currency support in Epic 2